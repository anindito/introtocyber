<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 700">
  <defs>
    <linearGradient id="headerGrad4" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#2c5282;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#4299e1;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="apGradient" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#38a169;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#276749;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="clientGradient" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#4299e1;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#2b6cb0;stop-opacity:1" />
    </linearGradient>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#4a5568"/>
    </marker>
    <marker id="arrowheadBlue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#3182ce"/>
    </marker>
    <marker id="arrowheadGreen" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#38a169"/>
    </marker>
    <filter id="shadow4" x="-10%" y="-10%" width="120%" height="120%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.2"/>
    </filter>
  </defs>
  
  <!-- Background -->
  <rect width="900" height="700" fill="#f0f9ff"/>
  
  <!-- Header -->
  <rect x="0" y="0" width="900" height="55" fill="url(#headerGrad4)"/>
  <text x="450" y="35" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="white" text-anchor="middle">
    Gambar 13.4: Proses 4-Way Handshake WPA2
  </text>
  
  <!-- Access Point Column -->
  <rect x="100" y="75" width="150" height="70" rx="10" fill="url(#apGradient)" filter="url(#shadow4)"/>
  <text x="175" y="105" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white" text-anchor="middle">Access Point</text>
  <text x="175" y="125" font-family="Arial, sans-serif" font-size="11" fill="#c6f6d5" text-anchor="middle">(Authenticator)</text>
  
  <!-- Client Column -->
  <rect x="650" y="75" width="150" height="70" rx="10" fill="url(#clientGradient)" filter="url(#shadow4)"/>
  <text x="725" y="105" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white" text-anchor="middle">Klien</text>
  <text x="725" y="125" font-family="Arial, sans-serif" font-size="11" fill="#bee3f8" text-anchor="middle">(Supplicant)</text>
  
  <!-- Timeline lines -->
  <line x1="175" y1="145" x2="175" y2="650" stroke="#38a169" stroke-width="3"/>
  <line x1="725" y1="145" x2="725" y2="650" stroke="#3182ce" stroke-width="3"/>
  
  <!-- Pre-shared Key Info Box -->
  <rect x="350" y="75" width="200" height="50" rx="5" fill="#fefcbf" stroke="#d69e2e" stroke-width="2"/>
  <text x="450" y="95" font-family="Arial, sans-serif" font-size="11" fill="#744210" text-anchor="middle" font-weight="bold">Pre-Shared Key (PSK)</text>
  <text x="450" y="112" font-family="Arial, sans-serif" font-size="10" fill="#744210" text-anchor="middle">Diketahui kedua pihak</text>
  
  <!-- Message 1 -->
  <g transform="translate(0, 160)">
    <rect x="185" y="0" width="530" height="60" rx="5" fill="#e6fffa" stroke="#38b2ac" stroke-width="1"/>
    <line x1="175" y1="30" x2="715" y2="30" stroke="#38a169" stroke-width="2" marker-end="url(#arrowheadGreen)"/>
    
    <circle cx="50" cy="30" r="25" fill="#38a169"/>
    <text x="50" y="35" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white" text-anchor="middle">1</text>
    
    <text x="450" y="18" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#234e52" text-anchor="middle">Pesan 1: ANonce</text>
    <text x="450" y="50" font-family="Arial, sans-serif" font-size="10" fill="#285e61" text-anchor="middle">
      AP mengirim nilai acak ANonce ke klien
    </text>
  </g>
  
  <!-- Client generates PTK -->
  <rect x="730" y="230" width="160" height="40" rx="5" fill="#ebf8ff" stroke="#3182ce" stroke-width="1"/>
  <text x="810" y="245" font-family="Arial, sans-serif" font-size="9" fill="#2b6cb0" text-anchor="middle" font-weight="bold">Klien menghitung PTK</text>
  <text x="810" y="260" font-family="Arial, sans-serif" font-size="8" fill="#2c5282" text-anchor="middle">PSK + ANonce + SNonce</text>
  
  <!-- Message 2 -->
  <g transform="translate(0, 280)">
    <rect x="185" y="0" width="530" height="60" rx="5" fill="#ebf8ff" stroke="#4299e1" stroke-width="1"/>
    <line x1="715" y1="30" x2="185" y2="30" stroke="#3182ce" stroke-width="2" marker-end="url(#arrowheadBlue)"/>
    
    <circle cx="50" cy="30" r="25" fill="#3182ce"/>
    <text x="50" y="35" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white" text-anchor="middle">2</text>
    
    <text x="450" y="18" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#2b6cb0" text-anchor="middle">Pesan 2: SNonce + MIC</text>
    <text x="450" y="50" font-family="Arial, sans-serif" font-size="10" fill="#2c5282" text-anchor="middle">
      Klien mengirim SNonce dan Message Integrity Code
    </text>
  </g>
  
  <!-- AP generates PTK -->
  <rect x="10" y="350" width="160" height="40" rx="5" fill="#f0fff4" stroke="#38a169" stroke-width="1"/>
  <text x="90" y="365" font-family="Arial, sans-serif" font-size="9" fill="#276749" text-anchor="middle" font-weight="bold">AP menghitung PTK</text>
  <text x="90" y="380" font-family="Arial, sans-serif" font-size="8" fill="#22543d" text-anchor="middle">PSK + ANonce + SNonce</text>
  
  <!-- Message 3 -->
  <g transform="translate(0, 400)">
    <rect x="185" y="0" width="530" height="60" rx="5" fill="#e6fffa" stroke="#38b2ac" stroke-width="1"/>
    <line x1="175" y1="30" x2="715" y2="30" stroke="#38a169" stroke-width="2" marker-end="url(#arrowheadGreen)"/>
    
    <circle cx="50" cy="30" r="25" fill="#38a169"/>
    <text x="50" y="35" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white" text-anchor="middle">3</text>
    
    <text x="450" y="18" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#234e52" text-anchor="middle">Pesan 3: GTK + MIC</text>
    <text x="450" y="50" font-family="Arial, sans-serif" font-size="10" fill="#285e61" text-anchor="middle">
      AP mengirim Group Temporal Key (terenkripsi PTK) + MIC
    </text>
  </g>
  
  <!-- Message 4 -->
  <g transform="translate(0, 490)">
    <rect x="185" y="0" width="530" height="60" rx="5" fill="#ebf8ff" stroke="#4299e1" stroke-width="1"/>
    <line x1="715" y1="30" x2="185" y2="30" stroke="#3182ce" stroke-width="2" marker-end="url(#arrowheadBlue)"/>
    
    <circle cx="50" cy="30" r="25" fill="#3182ce"/>
    <text x="50" y="35" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white" text-anchor="middle">4</text>
    
    <text x="450" y="18" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#2b6cb0" text-anchor="middle">Pesan 4: ACK</text>
    <text x="450" y="50" font-family="Arial, sans-serif" font-size="10" fill="#2c5282" text-anchor="middle">
      Klien mengkonfirmasi instalasi kunci berhasil
    </text>
  </g>
  
  <!-- Secure Communication -->
  <rect x="185" y="570" width="530" height="45" rx="5" fill="#c6f6d5" stroke="#38a169" stroke-width="2"/>
  <text x="450" y="595" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#22543d" text-anchor="middle">
    âœ“ Komunikasi Terenkripsi Dapat Dimulai
  </text>
  
  <!-- Key Legend Box -->
  <rect x="30" y="625" width="840" height="65" rx="5" fill="white" stroke="#cbd5e0" stroke-width="1" filter="url(#shadow4)"/>
  <text x="50" y="648" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#2d3748">Keterangan Istilah:</text>
  
  <text x="50" y="672" font-family="Arial, sans-serif" font-size="10" fill="#4a5568">
    <tspan font-weight="bold">ANonce:</tspan> Authenticator Nonce (nilai acak dari AP)
  </text>
  <text x="300" y="672" font-family="Arial, sans-serif" font-size="10" fill="#4a5568">
    <tspan font-weight="bold">SNonce:</tspan> Supplicant Nonce (nilai acak dari klien)
  </text>
  <text x="550" y="672" font-family="Arial, sans-serif" font-size="10" fill="#4a5568">
    <tspan font-weight="bold">PTK:</tspan> Pairwise Temporal Key
  </text>
  <text x="700" y="672" font-family="Arial, sans-serif" font-size="10" fill="#4a5568">
    <tspan font-weight="bold">GTK:</tspan> Group Temporal Key
  </text>
  
  <!-- MIC explanation -->
  <text x="50" y="685" font-family="Arial, sans-serif" font-size="10" fill="#4a5568">
    <tspan font-weight="bold">MIC:</tspan> Message Integrity Code - membuktikan pengirim mengetahui PSK tanpa mengirimkannya
  </text>
</svg>
